language: node_js
install: case $TRAVIS_BRANCH in greenkeeper*) npm i;; *) npm ci;; esac;
cache:
  directories:
  - node_modules
  - "$HOME/.npm"
jobs:
  include:
  - stage: test
    script:
    - npm run lint && npm run test && npm run coverage
  - stage: Build docker image and upload to dockerhub
    sudo: true
    services:
    - docker
    install: true
    if: tag IS present
    script:
    - export PATH=$PATH:$HOME/.local/bin
    - docker build --build-arg NODE_ENV=production --build-arg GIT_REV=`git rev-parse
      --short HEAD` -t windingtree/wt-hotel-explorer:$TRAVIS_BRANCH .
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    - docker push windingtree/wt-hotel-explorer:$TRAVIS_BRANCH
    - docker tag windingtree/wt-hotel-explorer:$TRAVIS_BRANCH windingtree/wt-hotel-explorer:latest
    - docker push windingtree/wt-hotel-explorer:latest
  - stage: NPM release
    if: tag IS present
    script:
    - npm run build
    deploy:
      provider: npm
      email: devops@windingtree.com
      skip_cleanup: true
      api_key: "$NPM_TOKEN"
      on:
        repo: windingtree/wt-hotel-explorer
        tags: true
  - stage: release-playground
    install: true
    if: branch = release/playground
    script:
    - pip install --user awscli
    - export PATH=$PATH:$HOME/.local/bin
    - export CF_ROOT=$CF_ROOT_PLAYGROUND
    - npm run deploy-aws-playground
  - stage: release-lisbon
    install: true
    if: branch = release/lisbon
    script:
    - pip install --user awscli
    - export PATH=$PATH:$HOME/.local/bin
    - export CF_ROOT=$CF_ROOT_LISBON
    - npm run deploy-aws-lisbon
env:
  global:
  - secure: 3GRN+gQfwBl7kYJ5euuiv9BWKFB2Hn8Lmwk8ebdyS+2Bqlzy2a/83uMx9Ru7qdRywXIsLEUeHAApiQ8ca4nOxneoZd19SSlOTDNze6XnjE6Vr618knl9PdBvQGWbia7ODNQF2uWRU4dEOatbebJ3Z/ZVXrfyD6dQWOpUD7Ho/6CwwjDkQoKpcueybsS6ujyXe+yzA5iM2zNMuqPD0aYsVKzqyrGxD5pz8PGxpNgPVFIv2EA3VvrcThrf7DNzghcMnrFeSi9/nU1cMf0EevF+pxVcR8rX9Aik97QYn9hgZLMbHPplEu+MEQHFuLM22rMh6cqkNOZGKGgnj7Dv1fqc56FQftVt2Gp79QhICQBkWc3Sflh7o+lvmjCtBmhkfGrDv5D78k8s53cbUX3CHKONbHFIelnJB+ZzZ/OyqVCb7YYXesUj5GRcXZQIMRZyMq6K0hcbudB5GENrV9DdLcYJVB+K5g5AhqxxStHAEfXhPxx2sIr6EBDaSndj84nzhFxYWnfQFdkshGtsJp5JFY7IuOH3o9vdFE0kqbTu1yOtlZHS0DPPZeupNLcBp/OnZm8B0Inbp+p39vIo8CvyvTYIyFh1yTCq1nFHHW/NDNwT+8oX2mH3PGXPzFjGR9x50e+5vd5VLVCY6aJvep+L2+QERJ7goGF6hyf4VpRWBm/Yhr0=
  - secure: EvP8YrTcwc8NL80Yb6Koo4E9I9U5FeduQYRqIMbg5k+bBLI8FK0cYqkrJIZcRYzF7MQE3sZMCZqqlns25kGikVPbUUmIzHwvaulLTT/sKM2xOOZf6kYV9j3clVz8y7WtZMumWgnPxMsGOgmWepKHxkrkAOP+15IBrX+FPAHpcvoUvggebzOShR1hG3TgXKwQ4/nFl4gIthn53AG9vhoWyqraqKi7BL+ph0HS3i6YbogAeXdHgL10TjSfUmmTBCEBph2pOry8l7L2zKTJsBRLAgmMWzklR4jPsM8x5R3Zbc3ZKqrw0HTIl9FD8gzVHAl8MKvYtdGKi0rDoNhCj2VbI9efTK9YdAxaJU3nuYmjVwl4vmqPBOQ/hA5L6FRX8krgJjfWYGmpqKSAQhe7OZUOge5jZ0XA2ocRIpjcU878Am6LYYBcGyTcTxmOzngIuNS/7Nu0nWbxBkgsib+xZOB3Cqb2vtsaPO71EOFakzK3vvlxRbkjkfWvZj4WYIHstVbbGcGulokjPSOnBqHsS9r97lF7x1A3FYJF0kcgqSokEUI0q630cUrYBgOqS4nd9SjcqHwwmvF9gFHgYRL9xkiqpmwb0vcpQPYZ0vMZ2xYH3Bh8OxipD8PsZAQ07pXSWYFiCl1793pOJTBngRCWncf0jIA+jG1cWBV14GIl224gED8=
  - secure: fEwltP3RbQyqKpk8CgiLvJPM0zOvyKXwfNJdEfb8p+RXuhB//O64g8pniiDNC7+jrV8oc9ruYN9mOPPhUb4AEayYoNcDbbaFlBRfKuwJ0df8/yp1KbLy/xNzeUdPHMMYRH61INoGoirBunt/96tgOAoSCuaxD5Q0fJQyGh6PLHyn2RIEq0e0tOCvuz1SuH4fZ17kt5MCkNQQdHW6UPgOThoERyzxD7v+NHf6U2RTv0kBrCHHoYkGJfBhDe5gnFLU33WDzuCIATx9QLRICIUVJVO1q+/2RaX6B7rO0ZKYzjN5rpv0cfwNYf58MJAJl90x66vNrDPzq2CXvauJAk5/MDds3r/BTWHGA2VthtdR2Jey7b5xQxkW/7pANZExqFg1XnMduGKgW+dY+o+gmlLTJbDDTlCTeOADRApdnsajyAkX5hGFlU0DtsEB2UWQ0B1QQlWZCDd2z/8lAdbeZSI9Y54uKlmfnnhuRXTYKmjmhsVBtT2C+pJtwmn7IRNlrA/Mn0Y9bM68U3/9mY8QgSLjni8W/4oUOlmfx5XvZALcO3zxRvmq1dQlRqLuaduVl6bqIqqGKGHVBk777PXI6oDkWqifVfbrCMY3f+leuCdWyURXQrnnW7tFGhnVwZysWnNNIb0MJnDqiunwmNABYV/WbRZzvTm9BvKz40bhxKVGKwI=
  - secure: b9tVrHQQ9dg7oBnQDbJI52spZsT4K8u2w4R4qfF4STGkdACbUpp9T7HAjJAGG8uXtB2HDfTSVgTFqpj60gETzjdJwdsTEkr3+VTNYig8S+8B107e2i2mtO2Fr/W80JKy7ZlZ4eKy4HUDXkvBCUFptrZZG90Kus1VJacLWzTJ4Z/gTJavKJyUaPxbMqY3Y3rWqg6jmEHe/QwyPKjQTYSRdGTJFGzjssua5VYeIeCHYS2lWi1lYxNl0G3f9vUGNhwzRfU4aWXt0R2tRETHyEg2wkIKWyuoqKYihy9yFZyELFELxzSziaBlwkokbc3mk4B1498jHGfrHJRZQ5LxEkrqQp6Uc/dTpvzWJ9zcl3i5yhztpe0mgmjJorLrT6JpopPlLBXKd5SMRBv73NPdE7sPtXRTmTHqjUDziUKiKfpoAzAdLuYvvBMhpCq3fcmxxgBZXSvv9DYernZGomfCYBYCfFQNAr4ILilvebjkh6soO6uLOMag4VDyZVaFtlZ3dzIAFjdDV4L3CCOFdrN+QVVoQK0AxIisSaCKOL8sJZcTW34wuw66FYXnMaNRxrsotNdMc7NTahQrfhbm2vpHh8Q/1xrBfhezd3C79mSP2JaJDNnG2sZz4ddfSNcnHIw3a1+aATmo4gT1Z0OIQuMUgxxyk7ktsivnTwpsG1HBgvExtWY=
  - secure: MN5CaFeaJ/liN+VyhnLYUAqDXR9U33HwQQlIgAHRFFVmDv8TQe5+lQ5ZnHeJJqls9mus9F3Y83sPICnyNA/qn84N6JI+0DQV+p/xwiNqsTIdbmAJEbzEzk4cy4z+Sk5bXT9l3cp8fTTPPUrNnWy/o1+C8ch/W5UarRluLJzKcNGtbflBrjGCjHk5zbqrTgEK2sxkVynfOofEUnajMAumeLhgAd4t7QbMpKL0gsEr9LIUKP8j5UDai7+7WWohczFxlYSRrTCGRd8oQdhd1lFca2fPD8bjodvSG8OBd0b9D11VP9zLyUJPQG9D1KOm3zS0Zp6uDgOZ6DCqc0g35QSyb3uc/HBf2C9b4G654xZKkMGdOo365gfohYSVkVmXFmYbQKSlN2IoPaPxmgZENLWwRzwSHhCGgvMbdD9IVvWneN+isfmrEmA27to/HpHteJS89hFJkYd+a1HZDYedGuxw8nsHuOR7kIiuRwzDUa3wEf1/k3jqHlN1/bPbTFDubnB9Obh4lXc5hn1embOTqLVP1ciQ+u5bATZ1gDy6ciTUyVx30f1PmSfgE4b9hLs9E8XYjQ3zBVNIYQGDvOT1N3C49IuUUIZZbhtLx0YOjyoR5NevLYLxh38b2eWM90Az9LQkPkv9el77G/f1LcPp9Tjg4c/+OPDtCyGNUs0xOMRfKvg=
  - secure: KjYoVx3WSFKvrMnMeLTl6YbeJ2xGm0w154UibtHUGTmVXtNGvuwy9a3b3b1tWV9usYnkuUHCBNI/0UJ8LjbGwdXKq28mxrkw0fXVSwvfRZMPY6vk4K7YeCEdKayhldVS4QPvYNjfFBQPjP5uOGc9Jwdfz+R4fRxOb7WqQteU4g+0+EbYGEPp05BXddeK7gByQbLrpClT0Qw6HqxP1rq3XzXgc9rak6sVmDBFRuXNTz79HZz/yKuI3855+rg5p4htKB1OgPJ5w70FiurZbL61nWRRSCF7F/5561ug+rsuUO2/3s05ILoAySf+IE5kokwKtUcyRz65w5XNeqGd1XyWhInNOASR7Ng7vaaW4Xe8vcfeZgzequnge75IRUnahk8n3cWxu7dRRjqAf1+hteySkYer+QuSheIEk/Qyo63Kgd/qqWSPihShNwTCjumJmFP1ma+MEmJvoMeRsh5lCaYO7cWXItyjE+EtAV01LlIoeFE7521Vx0B74WPRH3kCDSLku2cvvqcMx3Udvm4ad2m2rs2ORmupPByEcI60tU+PyO6StQPs6sjXrXvV/kroFyc35cdCwPbSeLkN5d/mRRborTERt9jsvJqZSbD8MrfiP+Csa0T8LFxNIVhJYCOKP0wsytiiJxvAjl57JtyiYRhwulUktRMwNpn5vd4mT7Yo87Q=
  - secure: ZU1N4GbXs/HFOizOWMy6EqfljffntH49FZ6yH8O0NGlDR+YVNuS+fJueSB1P3tCnaZpxB1hJp1WOe5MG10fjAmK/ykag+mreigKjo69P8jdBkipPkOpUVKVoKNKOeKBO65qrGmhacTedJ10QmZ1ldemnBiH4gRwgeql41Om3eTLfDfd7ZxiZTF4rTXU3cgUz5IBLvuDOh8qSzX3xcrSw24inHN0H95R23tCe8ukr3VgZoGH3gXeZDZPL3UP/jvaqoKRr/wdvJ/Ox3AdFXAI4rft0rrysp0fX6H3AqyuBTWuPeUa5kV0PJJn7IRxZJS4PuLmzy4UDsCnQGHcowBShuV4Jkx3URWxyixR4kTSBxL4pG+n6WiPd/9j1vPYdDS17vcEQhgVI0YYp9dduUO02iDcaYSotqhoHTb2xCbtjnWagDyqrVzTM3TpNwxF82g/UEmLwYToAwE6cGMnbBt1ATkouB+heZkgU054hja7cHqRWJBANjwZoh9XHmz1wNZFHGBaZ2KvZ1s8cxrphUpaEDIAHnX+bc0mfR6He/XrxbZboF3nGtLY5t1rIdKtapXtzSxl4mGP99PbW9ckvlb9hjvb26XxHWgvfk5uO4b5crMH3RQ9g9dnOsUFplb5nLLASAj5CjH/dbfALqy45VuoyOGLwwvUvljUuhiL2WA+JVZ4=
  - secure: 1CF5AVyuoWKrcRJdx3EFrxBHrbF6E3HHnNaYsIBaPVvTlMqLVAbRekLbwmk/7c75qYJ/CaSSONgd/Rvkuub9Kk9C1UwzdxdBVDw2A7d9nBAf7NOlY3TESm84IkqPbwLTXw40nWDbbqSiCA3T2euacRR4RWIZNhB+EmFdxgWqxA7vqWl+ttJE4U/9cohspvi6V7VGnNZYij8AlHH99tvKMXm0JcjvBiGh7A9sjdF1fnYh+NOOnx/Jx/U04Cwh8FQteFoQUPYyKo+gZeR+pucQ+NeeGZXR6kKIHYe+Bxjof9ztuPPbx4xGvfZ+15U1pfAFTuRDfY6gsptUywdp6oEnl/LLrZ93vPJ3JJ048wEOFrkxPPlqD0fQUoxoxQZ7mmn+mL4joinQg6XFJZtjwAiDDrVZre7lTT+6rj4aMsOiVie0W/snVn5GISNaOkQ+YBVz0tbwD/0dowTNh64B2ellAyxZHComkvABHWYfmCKzfFL06t0LjTaolAYC2tUL8t+lH04zcOhSIDFGpPLcTBDkQ0otC0eZQ7uEULC+YxuZBRIJVnA+XCcPUEuQgeLMI6bMHWli7KeDhUFn/MtcOfxU5KzIf47u6IJA4kbvJCt1vdV1auxxKyhAAtHc1gYtGwkG7X4BFatnCuWYXScBLx1zAsKS3MNMI5YbZDU5XIYr/cg=
  - secure: mLrv7cPeNMrQNQD9mJ74ZiMb7ID3lh1M/7QtaBSifoML4NfuGVHnnaSR+xJLms8jbhjC5mtUp6X3cceynGVV5r0ND8BCKCsTndbXIamgvzbSIAp1abdAnWdwoOrTMmA8xp/OsKGFq4VgxWj6X7PMQyzVE79FyIk8yqiUVlZjkP5SnTsy5Y4IGhsIENRMg9bZ60+3PJPeWQ+s/spg41YO8G58ygKbdJRkXOstJXnMUuOen/7gFN8/SkGEmfKarBlZB9Nq4J+EPt3nxUu/hcmgXP508NIkWel3NhOHcCS4NHGsYAVWgSAnBDABCJUbw3Gx3OsdojyD+wjM3cCZ66Ch6RsijS2j1RfVEUttM90LOeYBkCvBgxDqA1ibE9f2y4Glnu1OC3HuYmN1oqcFlCuOdojh4Iicxm6DPdCWS+of4kOWvaIDrc0yCBoSeSheylTXEnx1k0mKYTTNoefoDpSalExeXgqfFs5RPNfzjOnBgwRJ7G7Fl3hqkliVVHeY8gAgjclicbActh/BFsOpHr3Q59IXAc4+ypj1KcHdBtfRERqYX2e/SI7GxG12kwCAqtI5oBsEvBK8eCw0RYUhcgXOkw3LYIjtN3dfPZOy1Z2k4NL5LNBKvKrSqlFdxwIYFVCZcJo3LE99PkVWPxrfp6Ze6fOGmZcgzWWr1565XkSfHlg=
  - secure: ASfVyIW+mfxFPJSajFEmhRgM7RtnRN0cuCf0mP+4mdEPXDz0vU7l085O+xqDTV7OlBhfxOuN1OmCJ5DudeXw8VT6vAey1OMKI5wwJp8mbVP8F3/0EgVJRtbuKafW1C+mHhlMMJ5jHV0YHn7bl5JSbe6tMllkWFy/+ePVWFR7NVUfyOxDS4CaYdQBHzID9BR8IiJD8xunZinaurI47953rJ4+X/CdHzB+vai7gTIkDfndS1SxvOSH5aGnhHVEzs850nsHk+gbuH1+8i1L1mBbHPb+kg6N9k4gbFTvjAGYQMrHc5gQmwmFavcAec2anvBWzQtOxNKyXw2KFiNV3/GLYW8t/afXaLdTT6gVdNABkumzxAzwnae+nH+UC3EXOoq6CJ+569uB1KyUr17cx7aSmSCBy2uGLck6gqQ6gmauxUmv0zrx5ZE3AxC7iOJsxd2aI/3hUh1HlSyL/4hLZ9xPHWaL6OKhmnulj2HQkS96DTClpzdeBTJAUvj9XeN67tO9JLxa+URmY8k+/IQnQV6Oo2PgSzWLxp0uewBxwm8HaGsngs7ExXhxglztrFwV2ejGPatXYhD2l+JvKrGJWUU6pYpHG1sL858eNYwtddFEoJTFkvdL2fe+H8EKaMsdQ9SMeJmlEgj1tEckkfiEUcekEDNRzEdrnPceTI0urhio4qQ=
  - secure: sgD9POxThcZwKsO/tbTJg9EF7jCSSdOqsU850W2bPGlSZHo+VkbVga85nkizI6Wqq/5g/Yb/DXueS41uPlR5/C9cl0ecLdAeYtctbEjw7Y1HpHAGu2XyPS3Kinavn/xWcpKXxWlq9um7g8bl6C0rPxaml44800do+k5n6oLVao1r1dFl2SyIjRkYNOV7MPI7IAn530ctNkH65f2bS/zHOMKAoPHJO8wlfqjXGqGBWUNvuNmosBVU/bVbYDKKPLWaUMl88Jio1OhvGB2FUt6d+2VQBp5CJaOdpQFh4JQsA7q9qn8Js+cdAb6Y0ugZU/yQnQQndN9Phw979KEYh1RHSvXNCVS3sq+nhfFH6QPa3quJrzvLgyqz4uhQbfDCYBPQtUb8F7vlHDZe8An/Ovuvag89bslszgQ68ktUxJFMB9KlPoz1eG0IbvzMRdRLeU4njYOjZ/Yq41dQxCtzNnVXqoynoNiOB+D64t6bf44FNwqXzQxq0zTw+pG2o/p1fAIXIsZujoxNFQX/9SSzuhWgQA72WFmHYDekNVQ72/65MiNwTRc+dxL/+FDYkDmDQQKuEeZWhnnOlQ/eJb2NnzldnqGpj2vRZJKyMmOylPH1KQylRvql2DiTbf1Cr9Fgue/pF2p6g9ZGfHf8Z40TkyjL/Bssk8Rxn0Ta8t/ivnpW9EM=
  - secure: ApwSzB+8o9rVQeU9tUoXogjRGzULnfysq/obEVMcHjAdiw0qD9FPb7LDCdHn4j8ACUA6D3I6VOR9KvPHue/7I7jntHWd4+8viEmTJAg8RZ82ieKx/6uAxNe0EH6y3ZalxPtDaefZuegC1XeCmCSBMvZu9mW+iqeEoitdEXdaZN/Z6flN5hcjzhUoXTQ3Jb8VGKWKIHw96vUtA94bA1y4oyDtne2x3F+lNV6bCAW66xvacTnfasUMGAv2JkwcLoJpWD3OmpQFiG5T1Pq6JCLz8X/hsuC/OV8hJ7JKLBdrBdYlCx46t6SI2PtbEEmUVU3jlORsudFP1cmgJotJLfhdXz3QeBw/nj6AVLn54SwrtFDyVTrL4hYzsv8CqQEsc3nPHZon6Gp/g4Qi3xgCHQhE+M4EykKJe0mj8nsxIjSwlNCgzB/RgNsAiejCqvxaarefRP3FnuwZABSGZcJU2ZNhbUxWyJgy9gzayEgsqQtMl4ET7ox/zxA0DmE1iZn5VHBWjA4QMiLePTXCTOe3DTCcJQQf8S88ZuT+30hoQMdFlZ/IsYnLD+FlRAZtRvuZJH/JoU9fqJaqtJvl309doPM44MJeK2RdNOHsqyGwuf+3Yh3MZsT76HQtWAT149qmwwo3tvBoZuwCZUBLeeZeCxAWsUZnkrO67Ao1kMczhL4Xwjc=
